import struct
import numpy as np
import os

class ReadCSDose():
    
    def __init__(self,path):
        self.path = path
        self.data3D = None
        
    def read_binaryFile(self):
        path = self.path
        FloatSize = 4
        IntSize = 4
        if not os.path.isfile(path):  
            print 'Dose file: ' + path + 'not exits'
        f = open(path, 'rb')        
        shape = struct.unpack('3L',file.read(IntSize*3))        
        len = shape[0]*shape[1]*shape[2]
        tupleData = struct.unpack(str(len)+'f', file.read(FloatSize*len))
        data3D = np.array(tupleData).reshape(shape[2], shape[1],shape[0]) #change to depth,height,width (Tra:width = x, height = z)
        if self.direction.lower() == "width":
            data2D = data3D[0:shape[2],0:shape[1],int(self.Plane)]# width direction
            self._layer_cnt = shape[0]
        if self.direction.lower() == "height":
            data2D = data3D[0:shape[2],int(self.Plane),0:shape[0]]#height direction
            self._layer_cnt = shape[1]
        if self.direction.lower() != "width" and self.direction.lower() != "height":
            print "like this Gaussian(directory,grid,direction,plane), direction only support 'width' and height'"            
        np.squeeze(data2D)
        self.Data2D = data2D
        self.Data3D = data3D